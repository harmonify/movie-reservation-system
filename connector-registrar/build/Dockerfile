# From alpine
# Install curl
# Install PostgreSQL client
# Install MongoDB client

FROM alpine:3

ARG CONNECTOR_REGISTRAR_VERSION=1.0.0

RUN apk add --no-cache bash
RUN apk add --no-cache curl
RUN apk add --no-cache postgresql-client
RUN apk add --no-cache mongodb-tools

# Default runtime environment variables
ENV CONNECTOR_REGISTRAR_VERSION=${CONNECTOR_REGISTRAR_VERSION}
# ENV CONNECT_URL='http://localhost:8083'
# ENV SCHEMA_REGISTRY_URL='http://localhost:8081'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_CONNECTOR_NAME='user-service-outbox-postgresql-source-connector'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_DB_HOST='localhost'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_DB_PORT='5432'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_DB_USER='postgres'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_DB_NAME='user'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_DB_SCHEMA='public'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_DB_TABLE='user_outbox'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_TOPIC_NAME_TEMPLATE='public.user.$${routedByValue}.v1'
# ENV USER_SERVICE_OUTBOX_POSTGRESQL_SOURCE_RUN_MIGRATION='true'
# ENV MOVIE_SERVICE_MOVIES_MONGODB_SOURCE_CONNECTOR_NAME='movie-service-movies-mongodb-source-connector'
# ENV MOVIE_SERVICE_MOVIES_MONGODB_SOURCE_MONGO_CONNECTION_STRING='mongodb://localhost:27017'
# ENV MOVIE_SERVICE_MOVIES_MONGODB_SOURCE_MONGO_COLLECTION_NAME='movies'
# ENV MOVIE_SERVICE_MOVIES_MONGODB_SOURCE_TOPIC_NAME='public.movie.movies.v1'
# ENV MOVIE_SERVICE_MOVIES_MONGODB_SOURCE_RUN_MIGRATION='true'
# ENV MOVIE_SEARCH_SERVICE_ELASTICSEARCH_SINK_CONNECTOR_NAME='movie-search-service-elasticsearch-sink-connector'
# ENV MOVIE_SEARCH_SERVICE_ELASTICSEARCH_SINK_ELASTICSEARCH_CONNECTION_URL='http://localhost:9200'
# ENV MOVIE_SEARCH_SERVICE_ELASTICSEARCH_SINK_ELASTICSEARCH_USERNAME='elastic'
# ENV MOVIE_SEARCH_SERVICE_ELASTICSEARCH_SINK_ELASTICSEARCH_INDEX_NAME='movies'
# ENV MOVIE_SEARCH_SERVICE_ELASTICSEARCH_SINK_RUN_MIGRATION='true'

RUN mkdir /connector-registrar

WORKDIR /connector-registrar

ADD ../*.sh .

RUN find . -type f -name "*.sh" -exec chmod +x {} \;

CMD [ "bash", "/connector-registrar/run.sh" ]
